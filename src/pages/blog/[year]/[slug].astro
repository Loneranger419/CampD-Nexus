---
import SiteLayout from '../../../layouts/SiteLayout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import { withBase } from '../../../utils/paths';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => {
		const [year, slug] = post.slug.split('/');
		return {
			params: { year, slug },
			props: { post },
		};
	});
}

const { post } = Astro.props as { post: CollectionEntry<'blog'> };
const { Content } = await post.render();

const publishedLabel = post.data.published.toLocaleDateString(undefined, {
	month: 'short',
	day: 'numeric',
	year: 'numeric',
});
---

<SiteLayout title={post.data.title} description={post.data.summary}>
	<article class="prose prose-lg prose-invert max-w-none dark:prose-invert">
		<header class="mb-6 space-y-2">
			<p class="text-sm text-muted">
				By {post.data.author} · {publishedLabel}
			</p>
			<h1 class="text-4xl font-semibold text-foreground">{post.data.title}</h1>
			{post.data.tags.length > 0 && (
				<ul class="flex flex-wrap gap-2 text-xs text-muted">
					{post.data.tags.map((tag) => (
						<li class="rounded-full bg-accent/10 px-3 py-1 font-semibold uppercase tracking-wide text-accent">
							{tag}
						</li>
					))}
				</ul>
			)}
		</header>
		{post.data.heroImage && (
			<div class="mb-8 overflow-hidden rounded-[var(--tile-radius)] border border-border/40 bg-surface/80">
				<img class="h-64 w-full object-cover" src={post.data.heroImage} alt="" loading="lazy" />
			</div>
		)}
		<Content />
	</article>
	<footer class="mt-10 flex flex-wrap items-center justify-between gap-3 text-sm text-muted">
		<a class="btn-secondary" href={withBase('/blog')}>← Back to all posts</a>
		<p>Spotted a correction? Submit an edit via CMS or open a pull request.</p>
	</footer>
</SiteLayout>


