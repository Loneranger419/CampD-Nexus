---
import SiteLayout from '../../../layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { slugify } from '../../../utils/slugify';

type ModListEntry = CollectionEntry<'modLists'>;
type GuideEntry = CollectionEntry<'guides'>;

export async function getStaticPaths() {
	const modLists = await getCollection('modLists');
	const guides = await getCollection('guides');

	return modLists.map((modList) => {
		const gameSlug = modList.id;
		const relatedGuides = guides.filter(
			(guide) => slugify(guide.data.game) === gameSlug,
		);

		return {
			params: { game: gameSlug },
			props: {
				modList,
				guides: relatedGuides,
			},
		};
	});
}

const { modList, guides } = Astro.props as {
	modList: ModListEntry;
	guides: GuideEntry[];
};
---

<SiteLayout
	title={`${modList.data.game} Overview`}
	description={`Mod list and guides for ${modList.data.game}.`}
>
	<section class="space-y-6">
		<header class="space-y-2">
			<h1 class="text-3xl font-semibold text-foreground">{modList.data.game}</h1>
			<p class="prose-muted text-sm">
				Last updated{' '}
				{modList.data.updated.toLocaleDateString(undefined, {
					month: 'short',
					day: 'numeric',
					year: 'numeric',
				})}{' '}
				• Version {modList.data.version}
			</p>
			<p class="prose-muted text-base leading-relaxed">
				This page tracks the official CampD configuration for {modList.data.game}. Follow the steps below and
				check the guides for deeper context or role-specific advice.
			</p>
		</header>

		<div class="grid gap-6 lg:grid-cols-[1.5fr_1fr]">
			<section class="card space-y-4">
				<h2 class="text-xl font-semibold text-foreground">Mod Lineup</h2>
				<ul class="space-y-3">
					{modList.data.mods.map((mod) => (
						<li class="rounded-xl border border-border/30 bg-background/70 p-4">
							<div class="flex flex-wrap items-center justify-between gap-3">
								<div>
									<p class="text-lg font-semibold text-foreground">{mod.name}</p>
									{mod.author && <p class="text-xs uppercase tracking-wide text-muted">by {mod.author}</p>}
								</div>
								<span class="rounded-full bg-accent/10 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-accent">
									{mod.category.replace(/-/g, ' ')}
								</span>
							</div>
							<p class="prose-muted mt-2 text-sm leading-relaxed">{mod.description}</p>
							<a class="mt-3 inline-flex items-center gap-2 text-sm font-semibold text-accent" href={mod.link}>
								View mod
								<svg class="h-4 w-4" viewBox="0 0 24 24" aria-hidden="true">
									<path fill="currentColor" d="m13.6 5.2 5.6 5.6-5.6 5.6-1.2-1.2 3.4-3.4H6v-1.6h9.8L12.4 6.4Z" />
								</svg>
							</a>
							{!mod.required && (
								<p class="mt-2 text-xs text-muted">
									Optional: disable if performance is impacted or if you prefer the vanilla look.
								</p>
							)}
						</li>
					))}
				</ul>
			</section>
			<aside class="space-y-4">
				<section class="card space-y-3">
					<h3 class="text-lg font-semibold text-foreground">Resources</h3>
					<ul class="space-y-2 text-sm text-muted">
						{modList.data.resources.map((resource) => (
							<li class="rounded-xl border border-border/30 bg-background/70 px-3 py-2">
								<a class="text-foreground hover:text-accent" href={resource.url}>
									{resource.title}
								</a>
							</li>
						))}
					</ul>
					{modList.data.resources.length === 0 && (
						<p class="text-sm text-muted">Resource links coming soon.</p>
					)}
				</section>
				<section class="card space-y-3">
					<h3 class="text-lg font-semibold text-foreground">Guides</h3>
					{guides.length > 0 ? (
						<ul class="space-y-2 text-sm text-muted">
							{guides.map((guide) => (
								<li class="rounded-xl border border-border/30 bg-background/70 px-3 py-2">
									<a class="flex flex-col gap-1 text-foreground" href={`/games/${Astro.params.game}/guides/${guide.slug}`}>
										<span class="font-semibold">{guide.data.title}</span>
										<span>
											Updated{' '}
											{guide.data.updated.toLocaleDateString(undefined, {
												month: 'short',
												day: 'numeric',
												year: 'numeric',
											})}{' '}
											• Version {guide.data.version}
										</span>
									</a>
								</li>
							))}
						</ul>
					) : (
						<p class="text-sm text-muted">
							We’re drafting the first guide. In the meantime, share notes in the CampD Discord.
						</p>
					)}
				</section>
			</aside>
		</div>
		<section class="card border-dashed border-accent/40 bg-background/40 text-sm text-muted">
			<p>
				This page is a placeholder until the full automation pipeline lands. Expect more integration with the
				CMS and deployment tooling soon.
			</p>
		</section>
	</section>
</SiteLayout>

