---
import SiteLayout from '../../layouts/SiteLayout.astro';
import { getCollection } from 'astro:content';
import { slugify } from '../../utils/slugify';
import { withBase } from '../../utils/paths';

const modLists = await getCollection('modLists');
const guides = await getCollection('guides');

const games = modLists.map((modList) => {
	const gameSlug = modList.id;
	const relatedGuides = guides.filter(
		(guide) => slugify(guide.data.game) === gameSlug,
	);
	return {
		slug: gameSlug,
		modList,
		guides: relatedGuides,
	};
});
---

<SiteLayout title="Game Hub" description="Mod lists, guide links, and quick references for each CampD-supported title.">
	<section class="space-y-6">
		<header class="space-y-2">
			<h1 class="text-3xl font-semibold text-foreground">Game Hub</h1>
			<p class="prose-muted text-base leading-relaxed">
				Start here to get your mod setup dialed in. Each game has a curated mod list and at least one guide to
				get you ready for the next session.
			</p>
		</header>
		<div class="space-y-4">
			{games.map(({ slug, modList, guides }) => (
				<article class="card space-y-4">
					<header class="flex flex-wrap items-start justify-between gap-3">
						<div>
							<h2 class="text-2xl font-semibold text-foreground">{modList.data.game}</h2>
							<p class="prose-muted text-sm">
								Last updated{' '}
								{modList.data.updated.toLocaleDateString(undefined, {
									month: 'short',
									day: 'numeric',
									year: 'numeric',
								})}{' '}
								• Version {modList.data.version}
							</p>
						</div>
						<a class="btn" href={withBase(`/games/${slug}`)}>
							View overview
							<svg class="h-4 w-4" viewBox="0 0 24 24" aria-hidden="true">
								<path fill="currentColor" d="m13.6 5.2 5.6 5.6-5.6 5.6-1.2-1.2 3.4-3.4H6v-1.6h9.8L12.4 6.4Z" />
							</svg>
						</a>
					</header>
					<div class="grid gap-4 lg:grid-cols-[1.5fr_1fr]">
						<div>
							<h3 class="text-sm font-semibold uppercase tracking-wide text-accent">Mod Highlights</h3>
							<ul class="mt-2 space-y-2 text-sm text-muted">
								{modList.data.mods.slice(0, 3).map((mod) => (
									<li class="rounded-xl border border-border/40 bg-background/70 px-3 py-2">
										<span class="font-semibold text-foreground">{mod.name}</span> · {mod.description}
									</li>
								))}
							</ul>
						</div>
						<div>
							<h3 class="text-sm font-semibold uppercase tracking-wide text-accent">Guides</h3>
							{guides.length > 0 ? (
								<ul class="mt-2 space-y-2 text-sm text-muted">
									{guides.map((guide) => (
										<li class="rounded-xl border border-border/40 bg-background/70 px-3 py-2">
											<a class="flex flex-col gap-1 text-foreground" href={withBase(`/games/${slug}/guides/${guide.slug}`)}>
												<span class="font-semibold">{guide.data.title}</span>
												<span>Updated{' '}
													{guide.data.updated.toLocaleDateString(undefined, {
														month: 'short',
														day: 'numeric',
														year: 'numeric',
													})}
												</span>
											</a>
										</li>
									))}
								</ul>
							) : (
								<p class="prose-muted mt-2 text-sm">
									Guides are being drafted—check back soon or volunteer to outline one.
								</p>
							)}
						</div>
					</div>
				</article>
			))}
		</div>
		<div class="card border-dashed border-accent/40 bg-background/40 text-sm text-muted">
			<p>
				Don’t see your game? Drop a request in Discord. We can spin up a mod list once there’s interest and a
				point person to maintain it.
			</p>
		</div>
	</section>
</SiteLayout>

